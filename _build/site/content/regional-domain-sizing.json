{"version":3,"kind":"Notebook","sha256":"2dc7ee1c3d2249bb903126dc299e324de478755fe38b88f8a6417ba29940a021","slug":"regional-domain-sizing","location":"/regional-domain-sizing.ipynb","dependencies":[],"frontmatter":{"title":"Mapping the Extent of mCDR Signals within Finite Regional Domains","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"atlas-calcs","language":"python"},"authors":[{"nameParsed":{"literal":"[C]Worthy","family":"[C]Worthy"},"name":"[C]Worthy","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/CWorthy-Ocean/atlas-calcs","source_url":"https://github.com/CWorthy-Ocean/atlas-calcs/blob/main/regional-domain-sizing.ipynb","edit_url":"https://github.com/CWorthy-Ocean/atlas-calcs/edit/main/regional-domain-sizing.ipynb","exports":[{"format":"ipynb","filename":"regional-domain-sizing.ipynb","url":"/regional-domain-sizi-efe9fe1408f39970278dd3b7f1d1ac3d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"{{domain_name}}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NJpFfM7ZcB"}],"identifier":"id-domain-name","label":"{{domain_name}}","html_id":"id-domain-name","implicit":true,"key":"pNm0RLWgPV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to map the extent of marine Carbon Dioxide Removal (mCDR) signals within finite regional domains. The analysis involves:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"a9DmDDZeXI"}],"key":"YR1ONP6kAx"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Defining the regional model grid","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rEFFIsDojL"}],"key":"zbuQATPR9n"},{"type":"text","value":": Creating a finite regional ocean model grid using ROMS tools","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"stbnDveJxv"}],"key":"cgK4vEfYHu"}],"key":"e37yYuViSx"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Loading the global atlas grid","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"rBIxVssrRq"}],"key":"aXzYMMfgdJ"},{"type":"text","value":": Using the POP ocean model grid as the base for the atlas dataset","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"XBckDwLxdN"}],"key":"DuOuXTkgZD"}],"key":"xEph42EQzD"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Identifying overlapping polygons","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ixGeF3Nznf"}],"key":"rkWwfo6DlM"},{"type":"text","value":": Finding which atlas polygons intersect with the regional domain","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rRweJ165jN"}],"key":"QLHlEcp4pq"}],"key":"U67g5PFhsS"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Integrating CO2 fluxes","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ulSR7Y1u8M"}],"key":"IRoPp5AkJP"},{"type":"text","value":": Computing cumulative CO2 uptake within the regional domain boundaries","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"rcItyIQQze"}],"key":"J1OK4Lz8m2"}],"key":"MuD8iYDDBu"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Visualizing results","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"dbahdReMHk"}],"key":"PQu5nYVwHQ"},{"type":"text","value":": Mapping the fraction of CO2 uptake captured within the regional domain","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"XHBCx0lHUd"}],"key":"lldWRey1oy"}],"key":"AbtrkipinB"}],"key":"hUlftmn3iw"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The key challenge is determining what fraction of the global mCDR signal (from the atlas) is captured within a finite regional model domain, which is essential for understanding the efficiency and spatial extent of regional mCDR deployments.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"GH2g5nx77s"}],"key":"ptnXGrjuSg"}],"key":"g2XHJZr7UC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 1: Import Required Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sby84R4mzJ"}],"identifier":"step-1-import-required-libraries","label":"Step 1: Import Required Libraries","html_id":"step-1-import-required-libraries","implicit":true,"key":"hjHRLt7rHM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Load the necessary Python packages for data manipulation, grid handling, and analysis utilities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wnhhIc2PQ9"}],"key":"LhLYftWyQh"}],"key":"WkNde1h5oO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%load_ext autoreload\n%autoreload 2\n\nimport numpy as np\nimport xarray as xr\n\nimport roms_tools as rt\n\nimport cdr_atlas\nimport parsers\nimport utils","key":"yXBDpHTnkG"},{"type":"outputs","id":"mEG6yRM-7qWCLX_Ng-LxL","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/Users/mclong/miniconda3/envs/atlas-calcs/lib/python3.13/site-packages/pop_tools/__init__.py:4: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n  from pkg_resources import DistributionNotFound, get_distribution\n"},"children":[],"key":"FEQkV9cFB7"}],"key":"FiqQUQm97S"}],"key":"Srdu2iOaft"},{"type":"block","kind":"notebook-code","data":{"tags":["parameters"]},"children":[{"type":"code","lang":"python","executable":true,"value":"grid_yaml = \"tests/_grid.yml\"\ntest = True\ndask_cluster_kwargs = {\n    \"account\": \"m4632\",\n    \"queue_name\": \"premium\",\n    \"scheduler_file\": None,\n}","visibility":"show","key":"Il3upynQ3N"},{"type":"outputs","id":"14OQOamk5UzdN4M0h38H-","children":[],"visibility":"show","key":"tBW7UBjOkF"}],"visibility":"show","key":"OHusDVxyGt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 2: Define the Regional Model Grid","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S2v2jOQ1Jk"}],"identifier":"step-2-define-the-regional-model-grid","label":"Step 2: Define the Regional Model Grid","html_id":"step-2-define-the-regional-model-grid","implicit":true,"key":"wTu6IxVZSQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Create a finite regional ocean model grid using ROMS (Regional Ocean Modeling System) tools. This grid defines the spatial boundaries of our regional domain. The grid parameters include:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zTdTlJmsaY"}],"key":"CP3jmGCoLy"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grid dimensions","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rOF3Y1z3lm"}],"key":"RfVqsGZxaT"},{"type":"text","value":": number of grid points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"otxwl5LTEj"}],"key":"zxHv4ILgYR"}],"key":"mYrSWCx8Cq"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Physical size","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vqqG9owfRX"}],"key":"cwpLPJv4HM"},{"type":"text","value":": domain extent","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RW79W6a5Wr"}],"key":"svCqjOHj3P"}],"key":"s57DDanyCZ"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Center location","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"EqHUL8FHZW"}],"key":"Uygg66tz6Q"},{"type":"text","value":": geographic center","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"axAy0hNn3F"}],"key":"iUB5BthetK"}],"key":"J1N1JFKpGh"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Rotation","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"KFusbQgpYL"}],"key":"E8wiMYejwp"},{"type":"text","value":": grid rotation angle","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"dhxwcvJPpX"}],"key":"R4SBUlnmff"}],"key":"faD2hJib8q"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Vertical levels","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qQgdmZL4GB"}],"key":"zuLqjfLBJq"},{"type":"text","value":": number of vertical sigma levels","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ywsp8R3Y6h"}],"key":"oWXH1uqgsq"}],"key":"zm9fqyMnYX"}],"key":"hMWLeSPopd"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The grid is plotted to visualize the regional domain extent.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"moLQQ8sILM"}],"key":"sn3Ru3kksb"}],"key":"j56aGjWyu6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model_grid = parsers.load_roms_tools_object(grid_yaml)\nmodel_grid.plot()","key":"B95qXfTjp6"},{"type":"outputs","id":"Rtff74ftrpnjkHjXuXLrG","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"16ae1f23ae1707a868f122bfdd45dd9f","path":"/16ae1f23ae1707a868f122bfdd45dd9f.png"},"text/plain":{"content":"<Figure size 1300x700 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"SzjstkQH5l"}],"key":"HKWFZwT8LA"}],"key":"AhI7ouTEz3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 2: Load the Global Atlas Grid","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OO8PKjuSHA"}],"identifier":"step-2-load-the-global-atlas-grid","label":"Step 2: Load the Global Atlas Grid","html_id":"step-2-load-the-global-atlas-grid","implicit":true,"key":"iczngt4PXM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Load the POP (Parallel Ocean Program) global ocean model grid (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"V5Evm1zw8G"},{"type":"inlineCode","value":"POP_gx1v7","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n5gCZJwH0G"},{"type":"text","value":"), which serves as the base grid for the atlas dataset. This grid provides the spatial coordinates (TLAT, TLONG) and cell areas (TAREA) needed for area-weighted calculations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cDjaRsHtnX"}],"key":"frczs2Sxh6"}],"key":"fVIEi0WgNV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"atlas_grid = cdr_atlas.get_pop_grid()\natlas_grid","key":"cQoWgu5JlR"},{"type":"outputs","id":"b9YGQUJW_Ur5nr8UC_zXJ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"2a84ac3bc50730d6b0b722465cfec92b","path":"/2a84ac3bc50730d6b0b722465cfec92b.html"},"text/plain":{"content":"<xarray.Dataset> Size: 11MB\nDimensions:      (nlat: 384, nlon: 320, z_t: 60, z_w: 60, z_w_bot: 60, nreg: 13)\nCoordinates:\n  * z_t          (z_t) float64 480B 500.0 1.5e+03 ... 5.125e+05 5.375e+05\n  * z_w          (z_w) float64 480B 0.0 1e+03 2e+03 ... 4.75e+05 5e+05 5.25e+05\n  * z_w_bot      (z_w_bot) float64 480B 1e+03 2e+03 3e+03 ... 5.25e+05 5.5e+05\n  * nreg         (nreg) int64 104B 0 1 2 3 4 5 6 7 8 9 10 11 12\nDimensions without coordinates: nlat, nlon\nData variables: (12/15)\n    TLAT         (nlat, nlon) float64 983kB -79.22 -79.22 -79.22 ... 72.19 72.19\n    TLONG        (nlat, nlon) float64 983kB 320.6 321.7 322.8 ... 319.4 319.8\n    ULAT         (nlat, nlon) float64 983kB -78.95 -78.95 -78.95 ... 72.41 72.41\n    ULONG        (nlat, nlon) float64 983kB 321.1 322.3 323.4 ... 319.6 320.0\n    DXT          (nlat, nlon) float64 983kB 1.894e+06 1.893e+06 ... 1.473e+06\n    DYT          (nlat, nlon) float64 983kB 5.94e+06 5.94e+06 ... 5.046e+06\n    ...           ...\n    UAREA        (nlat, nlon) float64 983kB 1.423e+13 1.423e+13 ... 7.639e+12\n    KMT          (nlat, nlon) int32 492kB 0 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0\n    REGION_MASK  (nlat, nlon) int32 492kB 0 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0\n    dz           (z_t) float64 480B 1e+03 1e+03 1e+03 ... 2.5e+04 2.5e+04\n    region_name  (nreg) <U21 1kB 'Black Sea' 'Baltic Sea' ... 'Hudson Bay'\n    region_val   (nreg) int64 104B -13 -12 -5 1 2 3 4 6 7 8 9 10 11\nAttributes:\n    lateral_dims:       [384, 320]\n    vertical_dims:      60\n    vert_grid_file:     gx1v7_vert_grid\n    horiz_grid_fname:   inputdata/ocn/pop/gx1v7/grid/horiz_grid_20010402.ieeer8\n    topography_fname:   inputdata/ocn/pop/gx1v7/grid/topography_20161215.ieeei4\n    region_mask_fname:  inputdata/ocn/pop/gx1v7/grid/region_mask_20151008.ieeei4\n    type:               dipole\n    title:              POP_gx1v7 grid","content_type":"text/plain"}}},"children":[],"key":"XoG4bzKZBS"}],"key":"w4DMUhQwQt"}],"key":"cwuGhI2bjQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 4: Load Polygon Masks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FpjGXETweo"}],"identifier":"step-4-load-polygon-masks","label":"Step 4: Load Polygon Masks","html_id":"step-4-load-polygon-masks","implicit":true,"key":"lQpYaaooLO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Load the polygon masks from the atlas dataset. Each polygon represents a distinct mCDR injection location. The polygon IDs are masked to only include ocean points (where ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"seRD9hV7bD"},{"type":"inlineCode","value":"KMT > 0","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hYa60Ru0fp"},{"type":"text","value":", indicating valid ocean grid cells).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FSBDRRm0cv"}],"key":"wVZEghdhdE"}],"key":"WiV4g8b0Yj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_atlas_polygons = cdr_atlas.get_polygon_masks_dataset()\npolygon_ids = ds_atlas_polygons.polygon_id.where(atlas_grid.KMT > 0)\npolygon_ids.plot()","key":"IIs76Xktev"},{"type":"outputs","id":"cTXsIPwBJnkYYPG6iJctE","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"55861ee523c4fdcb634b9f71bd9b7e35","path":"/55861ee523c4fdcb634b9f71bd9b7e35.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"LrzwkTH3cV"}],"key":"ff4fZOfcbC"}],"key":"AtdvSCPTLj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 5: Create Analyzer and Identify Overlapping Polygons","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VCI29UuOi7"}],"identifier":"step-5-create-analyzer-and-identify-overlapping-polygons","label":"Step 5: Create Analyzer and Identify Overlapping Polygons","html_id":"step-5-create-analyzer-and-identify-overlapping-polygons","implicit":true,"key":"xA4CJCwlZV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Initialize the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ds35kLRyR8"},{"type":"inlineCode","value":"AtlasModelGridAnalyzer","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oYcflENGrD"},{"type":"text","value":" class, which:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W6nFDx82Cm"}],"key":"DrROPQv41k"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Computes the convex hull","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hFkPop6vho"}],"key":"pdWgoAm2BG"},{"type":"text","value":" of the regional model grid using all lat/lon points from ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sgb61Ngy26"},{"type":"inlineCode","value":"model_grid.ds.lat_u","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"olZkAq8Bmg"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Zs9PCQqTIL"},{"type":"inlineCode","value":"lon_u","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MbJRlvBzbW"}],"key":"REXTVt0b7w"}],"key":"j6qTcdJlFv"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Performs point-in-polygon tests","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"i1ER3BjYEZ"}],"key":"HSIrUktz6G"},{"type":"text","value":" to identify which atlas grid points fall within the regional domain boundaries","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vaDfYpNDbm"}],"key":"VdzjQHGQIo"}],"key":"bPecYItWK1"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Extracts unique polygon IDs","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P9YRWSX9UO"}],"key":"vPyLuGD0jR"},{"type":"text","value":" that have at least some overlap with the regional domain","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ECbxADVxWR"}],"key":"kMUWngRitk"}],"key":"PxRUoxCYYw"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Creates a polygon ID mask","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wjEJqdkztg"}],"key":"tyq2IKXznK"},{"type":"text","value":" where polygon IDs are set to -1 outside the regional domain","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"jy2LNvzLvI"}],"key":"ECFTxUUN7J"}],"key":"jdifkarFQI"}],"key":"Uvx3h29Ucw"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The analyzer uses a convex hull approach (rather than a simple bounding box) to accurately handle non-rectangular regional domains. The resulting mask shows which polygons intersect with the regional domain.p","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sHCS4EOrk7"}],"key":"zBsydhz5a2"}],"key":"szQdT1xuhe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create AtlasModelGridAnalyzer instance\nanalyzer = cdr_atlas.AtlasModelGridAnalyzer(model_grid, atlas_grid, polygon_ids=polygon_ids)\n\n# Get polygon IDs within model grid boundaries\nprint(f\"Found {len(analyzer.polygon_ids_in_bounds)} unique polygon IDs within model grid boundaries\")\nprint(f\"Polygon IDs: {analyzer.polygon_ids_in_bounds[:100]}...\" if len(analyzer.polygon_ids_in_bounds) > 100 else f\"Polygon IDs: {analyzer.polygon_ids_in_bounds}\")\n\nanalyzer.polygon_id_mask.plot(vmin=-1, vmax=analyzer.polygon_id_mask.max())","key":"qjTYpmfysP"},{"type":"outputs","id":"xNwqNVRlVYkph7hi5jiI6","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Found 36 unique polygon IDs within model grid boundaries\nPolygon IDs: [160. 163. 173. 185. 186. 193. 200. 215. 218. 227. 231. 240. 244. 249.\n 255. 256. 257. 268. 279. 283. 284. 291. 295. 298. 300. 301. 305. 310.\n 318. 323. 328. 330. 333. 342. 346. 347.]\n"},"children":[],"key":"EvpG9TIF2V"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7ff1b5c9f1cd2e648ccc9e4012573f12","path":"/7ff1b5c9f1cd2e648ccc9e4012573f12.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"idA7t8LF5y"}],"key":"xLUBaRio3V"}],"key":"bi8NYRHSWc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 6: Test: Integrate CO","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uQnwblYlun"},{"type":"subscript","children":[{"type":"text","value":"2","key":"miI19Xmz11"}],"key":"y0Snq3g36W"},{"type":"text","value":" Flux for a Single Polygon","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aCaKuOLUOD"}],"identifier":"step-6-test-integrate-co2-flux-for-a-single-polygon","label":"Step 6: Test: Integrate CO2 Flux for a Single Polygon","html_id":"step-6-test-integrate-co2-flux-for-a-single-polygon","implicit":true,"key":"rH5L48kzmW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Compute the cumulative CO2 uptake for a single polygon over a 3-month period. The integration:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gZ9CB4Go4W"}],"key":"k8StW8R2p4"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Retrieves alk-forcing files","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Vihp3ib8p0"}],"key":"Ybu5k7UEqp"},{"type":"text","value":" from S3 (with local caching) for the specified polygon, injection date, and time period","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TgKzfICaqI"}],"key":"vYPRuOvovx"}],"key":"yZoW7URny9"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Calculates the additional CO2 flux","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yGgzaajyBf"}],"key":"UrSrFuP4uk"},{"type":"text","value":" (","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fY2s6kUpkw"},{"type":"inlineCode","value":"FG_CO2_additional = FG_CO2 - FG_ALT_CO2","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hxzpQTQB1u"},{"type":"text","value":") which represents the mCDR signal","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"b7qmW2aqNa"}],"key":"mcdrL6Gw9c"}],"key":"hlif9mwZpj"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Integrates over space and time","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Y43zcvOHDb"}],"key":"kgMi4bNcGo"},{"type":"text","value":" using:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uenzfpnAXE"}],"key":"eHr7qJpijR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Area weighting with ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"dySrqMRs2J"},{"type":"inlineCode","value":"TAREA","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ELPGPz08N7"},{"type":"text","value":" (grid cell areas)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"jsdjiyca5V"}],"key":"icZj0NDBUT"}],"key":"SmdZmtyC8x"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Time weighting with days per month converted to seconds","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"guXoIFFURO"}],"key":"FykpQ1QKBD"}],"key":"W9KaMZsffP"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Spatial masking to restrict to points within the regional domain","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"YLOyL1edfi"}],"key":"kj3EgcxpNp"}],"key":"w1ErkouKOi"}],"key":"SvyAfFgM9s"}],"key":"MVEJY0bUrn"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Computes cumulative integrals","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"eAEGy9EMjh"}],"key":"jPM568p1Ve"},{"type":"text","value":" over the elapsed time dimension","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ImxSWoyWba"}],"key":"AzdwPsfpR0"}],"key":"MIXzXgLffP"}],"key":"zA2vsBDt6s"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The results show:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ScLPpFFHMe"}],"key":"KRKoyjCxTD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Total integrated FG_CO2","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"xzL7hz7OQB"}],"key":"b6WgRFB9Si"},{"type":"text","value":": Total CO2 uptake over the entire polygon extent","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ZAyDC0JSDq"}],"key":"N7zT4P6lhL"}],"key":"zryEpRkEH4"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Within model grid","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"e2JL81QG0o"}],"key":"KqEB2kzhL1"},{"type":"text","value":": CO2 uptake within the regional domain boundaries","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"EUFTQg6F1e"}],"key":"lD41DlsMyU"}],"key":"rSTIEywAqf"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Fraction within grid","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WkSlxyhxYM"}],"key":"wkNFS4mvit"},{"type":"text","value":": Percentage of total uptake captured by the regional domain","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"OwwIh3UmC7"}],"key":"oqybyYTO8u"}],"key":"VgZn7O9tbK"}],"key":"pQcsIh4maM"}],"key":"tovqHLiZAH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"years = [347+i for i in range(15)]\nyears","key":"LCyJxt7Bb0"},{"type":"outputs","id":"4_nSN55T5cvzNUSTZ8QEB","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"[347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361]","content_type":"text/plain"}}},"children":[],"key":"Gk7DGMkLxv"}],"key":"pRpcdbQbxh"}],"key":"Fu5wNYXRHO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cluster = utils.dask_cluster(**dask_cluster_kwargs)\ncluster","key":"Vd1W52XLor"},{"type":"outputs","id":"waw2g-5JBPvTgG9wqV9Hu","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2026-01-16 07:09:40 - INFO - To route to workers diagnostics web server please install jupyter-server-proxy: python -m pip install jupyter-server-proxy\n/Users/mclong/miniconda3/envs/atlas-calcs/lib/python3.13/site-packages/distributed/node.py:188: UserWarning: Port 8787 is already in use.\nPerhaps you already have a cluster running?\nHosting the HTTP server on port 54670 instead\n  warnings.warn(\n2026-01-16 07:09:40 - INFO - State start\n2026-01-16 07:09:40 - INFO - Found stale lock file and directory '/var/folders/x8/7n8hknbj717fxnf07pnk3pch0000gn/T/dask-scratch-space/scheduler-urrbp75i', purging\n2026-01-16 07:09:40 - INFO -   Scheduler at:     tcp://127.0.0.1:54671\n2026-01-16 07:09:40 - INFO -   dashboard at:  http://127.0.0.1:54670/status\n2026-01-16 07:09:40 - INFO - Registering Worker plugin shuffle\n2026-01-16 07:09:40 - INFO -         Start Nanny at: 'tcp://127.0.0.1:54674'\nNumba: Attempted to fork from a non-main thread, the TBB library may be in an invalid state in the child process.\n2026-01-16 07:09:40 - INFO -         Start Nanny at: 'tcp://127.0.0.1:54676'\n2026-01-16 07:09:40 - INFO -         Start Nanny at: 'tcp://127.0.0.1:54678'\nNumba: Attempted to fork from a non-main thread, the TBB library may be in an invalid state in the child process.\n2026-01-16 07:09:40 - INFO -         Start Nanny at: 'tcp://127.0.0.1:54680'\nNumba: Attempted to fork from a non-main thread, the TBB library may be in an invalid state in the child process.\nNumba: Attempted to fork from a non-main thread, the TBB library may be in an invalid state in the child process.\nNumba: Attempted to fork from a non-main thread, the TBB library may be in an invalid state in the child process.\n2026-01-16 07:09:40 - INFO - Register worker addr: tcp://127.0.0.1:54683 name: 1\n2026-01-16 07:09:40 - INFO - Starting worker compute stream, tcp://127.0.0.1:54683\n2026-01-16 07:09:40 - INFO - Starting established connection to tcp://127.0.0.1:54692\n2026-01-16 07:09:40 - INFO - Register worker addr: tcp://127.0.0.1:54682 name: 3\n2026-01-16 07:09:40 - INFO - Starting worker compute stream, tcp://127.0.0.1:54682\n2026-01-16 07:09:40 - INFO - Starting established connection to tcp://127.0.0.1:54693\n2026-01-16 07:09:40 - INFO - Register worker addr: tcp://127.0.0.1:54684 name: 0\n2026-01-16 07:09:40 - INFO - Starting worker compute stream, tcp://127.0.0.1:54684\n2026-01-16 07:09:40 - INFO - Starting established connection to tcp://127.0.0.1:54691\n2026-01-16 07:09:40 - INFO - Register worker addr: tcp://127.0.0.1:54685 name: 2\n2026-01-16 07:09:40 - INFO - Starting worker compute stream, tcp://127.0.0.1:54685\n2026-01-16 07:09:40 - INFO - Starting established connection to tcp://127.0.0.1:54690\n2026-01-16 07:09:40 - INFO - Receive client connection: Client-ffee4a52-f2e4-11f0-85a6-26da8a241958\n2026-01-16 07:09:40 - INFO - Starting established connection to tcp://127.0.0.1:54694\n"},"children":[],"key":"pn06Wp2RBG"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Local cluster running at http://127.0.0.1:54670/status\n"},"children":[],"key":"HUIusKgWAo"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"<utils.dask_cluster at 0x3375b5d30>","content_type":"text/plain"}}},"children":[],"key":"sWbVL1X5XE"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2026-01-16 07:09:44 - INFO - Retire worker addresses (stimulus_id='retire-workers-1768572584.138759') (0, 1, 2, 3)\n2026-01-16 07:09:44 - INFO - Received 'close-stream' from tcp://127.0.0.1:54691; closing.\n2026-01-16 07:09:44 - INFO - Received 'close-stream' from tcp://127.0.0.1:54692; closing.\n2026-01-16 07:09:44 - INFO - Received 'close-stream' from tcp://127.0.0.1:54690; closing.\n2026-01-16 07:09:44 - INFO - Remove worker addr: tcp://127.0.0.1:54684 name: 0 (stimulus_id='handle-worker-cleanup-1768572584.146964')\n2026-01-16 07:09:44 - INFO - Remove worker addr: tcp://127.0.0.1:54683 name: 1 (stimulus_id='handle-worker-cleanup-1768572584.147637')\n2026-01-16 07:09:44 - INFO - Remove worker addr: tcp://127.0.0.1:54685 name: 2 (stimulus_id='handle-worker-cleanup-1768572584.148402')\n2026-01-16 07:09:44 - INFO - Received 'close-stream' from tcp://127.0.0.1:54693; closing.\n2026-01-16 07:09:44 - INFO - Remove worker addr: tcp://127.0.0.1:54682 name: 3 (stimulus_id='handle-worker-cleanup-1768572584.1598258')\n2026-01-16 07:09:44 - INFO - Lost all workers\n2026-01-16 07:09:44 - INFO - Closing scheduler. Reason: unknown\n2026-01-16 07:09:44 - INFO - Scheduler closing all comms\n"},"children":[],"key":"r3b1oVLNQY"}],"key":"HPPfkrvMa4"}],"key":"goj8csO0zS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# Integrate FG_CO2 for polygon 000 over 3 months\n# Using the alk-forcing files: 0347-01, 0347-02, 0347-03\nresults = analyzer.integrate_fg_co2_polygon(\n    polygon_id=analyzer.polygon_ids_in_bounds[-1],\n    years=years[-2:-1],\n    months=[1, 2, 3],\n)\n\nprint(\"FG_CO2 Integration Results:\")\nprint(f\"  Total integrated FG_CO2: {results['total'].values[-1]:.2e}\")\nprint(f\"  Within model grid: {results['within_grid'].values[-1]:.2e}\")\nprint(f\"  Fraction within grid: {results['fraction'].values[-1]:.2%}\")","key":"Rp1v4vBH2s"},{"type":"outputs","id":"PCJX1gCogGTb7ptH5KuM2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Using cached files for all 3 requested file(s).\nFG_CO2 Integration Results:\n  Total integrated FG_CO2: 7.12e+08\n  Within model grid: 3.16e+08\n  Fraction within grid: 44.41%\nCPU times: user 331 ms, sys: 80.5 ms, total: 411 ms\nWall time: 2.99 s\n"},"children":[],"key":"SYJL2IiYP4"}],"key":"mdIiGsDYYK"}],"key":"pF463dqm6l"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 7: Integrate CO","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Sau6YAK4b7"},{"type":"subscript","children":[{"type":"text","value":"2","key":"sbXQr0869T"}],"key":"BvO8nYRdL1"},{"type":"text","value":" Flux for All Overlapping Polygons","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fc8DTr9a99"}],"identifier":"step-7-integrate-co2-flux-for-all-overlapping-polygons","label":"Step 7: Integrate CO2 Flux for All Overlapping Polygons","html_id":"step-7-integrate-co2-flux-for-all-overlapping-polygons","implicit":true,"key":"gi3cZDp1ml"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Compute the cumulative CO2 uptake for all polygons that intersect with the regional domain. This provides a comprehensive view of how much of the global mCDR signal is captured within the finite regional domain. The results are concatenated along the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hZe4LPsfyK"},{"type":"inlineCode","value":"polygon_id","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xPCXBwKip1"},{"type":"text","value":" dimension, creating a dataset with dimensions ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gC06Rk8t8G"},{"type":"inlineCode","value":"(polygon_id, elapsed_time)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"J6xaHiuTNy"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VPuGG5fXYl"}],"key":"JjFOAPE4Vw"}],"key":"uS4kc47nKL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nds = None\nif not test:\n    ds = analyzer.integrate_fg_co2_all_polygons(\n        years=years,\n    )   \nds","key":"eVk960VIfz"},{"type":"outputs","id":"OGDCp9_gG_f1niN466AHV","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 9 μs, sys: 0 ns, total: 9 μs\nWall time: 10 μs\n"},"children":[],"key":"CJ4kVsBwIF"}],"key":"MoxZCXSJ1W"}],"key":"T9AU0mUr78"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 8: Visualize Fraction of Uptake within Regional Domain","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PtSRdIJyaE"}],"identifier":"step-8-visualize-fraction-of-uptake-within-regional-domain","label":"Step 8: Visualize Fraction of Uptake within Regional Domain","html_id":"step-8-visualize-fraction-of-uptake-within-regional-domain","implicit":true,"key":"AP7tB4nb2i"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Map the fraction of CO2 uptake captured within the regional domain for each polygon. The visualization shows:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DNGXmvw358"}],"key":"hY3K6Ty0Tu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Red regions","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QHqHan25Sn"}],"key":"v61dRwGSGR"},{"type":"text","value":": Polygons where a large fraction of CO2 uptake occurs within the regional domain","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QFgYTvQgOh"}],"key":"ya1GTELz6F"}],"key":"AEx3XEaTHV"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Blue regions","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Oy75TElSTv"}],"key":"EIzQEbhgA4"},{"type":"text","value":": Polygons where most CO2 uptake occurs outside the regional domain","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"kLZSURmPDE"}],"key":"aVphxCxKs7"}],"key":"hPXwcfwtZT"}],"key":"Qk1xALoiXe"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"This spatial map helps identify which mCDR injection locations are most effectively captured by the regional model domain, which is critical for understanding the efficiency of regional mCDR monitoring and modeling efforts.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TFoN1vnb7K"}],"key":"sBPvIlZaVD"}],"key":"Rdd9HengA0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"if ds is not None:\n    analyzer.set_field_within_boundaries(ds.fraction.isel(elapsed_time=-1)).plot(cmap=\"RdBu_r\")\n","key":"L9sP5fe0FQ"},{"type":"outputs","id":"VjzlxjSSm1itVTdmwBZ6A","children":[],"key":"lhmLs2o79Y"}],"key":"VGWunziJsO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# check if LocalCluster is running and shutdown\nif cluster.local_cluster:\n    cluster.shutdown()","key":"KXTI8hINPp"},{"type":"outputs","id":"cQlkC4ZiydbmXFLVSQgI1","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2026-01-16 07:09:44 - INFO - Closing Nanny at 'tcp://127.0.0.1:54674'. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Nanny asking worker to close. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Closing Nanny at 'tcp://127.0.0.1:54676'. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Nanny asking worker to close. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Closing Nanny at 'tcp://127.0.0.1:54678'. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Nanny asking worker to close. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Closing Nanny at 'tcp://127.0.0.1:54680'. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Nanny asking worker to close. Reason: nanny-close\n2026-01-16 07:09:44 - INFO - Nanny at 'tcp://127.0.0.1:54678' closed.\n2026-01-16 07:09:44 - INFO - Nanny at 'tcp://127.0.0.1:54680' closed.\n2026-01-16 07:09:44 - INFO - Nanny at 'tcp://127.0.0.1:54676' closed.\n2026-01-16 07:09:44 - INFO - Nanny at 'tcp://127.0.0.1:54674' closed.\n"},"children":[],"key":"wPORFTOkbO"}],"key":"BzX6tsFdT7"}],"key":"Uzryo5CTdF"}],"key":"CuJG8LcveS"},"references":{"cite":{"order":[],"data":{}}}}